<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BookShelf</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<%- include('partials/header') %>

<div class="button-holder"><a class="add-book" href="/add">Add Book</a></div>
<h2> Books Read: <strong><%= books.length %></strong></h2>


<div class="books">
  <% books.forEach(book => { %>
    <div class="parent">
      <div class="book-card">

        <div class="cover">
          <% if (book.cover_id) { %>
            <img src="https://covers.openlibrary.org/b/isbn/<%= book.cover_id %>-M.jpg" alt="Book cover">
          <% } else { %>
            <div class="no-cover">No Cover</div>
          <% } %>
        </div>

        <div class="info">
          <h3><%= book.title %></h3>
          <p><strong>Author:</strong> <%= book.author %></p>
          <p><strong>Rating:</strong> <%= book.rating %>/5</p>
          <p><%= book.description %></p>

          <div class="actions">
            <a class="btn-edit" href="/edit/<%= book.id %>">Edit</a>

            <form action="/books/<%= book.id %>/delete" method="POST" class="delete-form">
              <button type="button" class="btn-delete" onclick="confirmSweetDelete(this.form)">Delete</button>
            </form>
          </div>
        </div>

      </div>
    </div>
  <% }) %>
</div>

<script>
function confirmSweetDelete(form) {
  Swal.fire({
    title: 'Are you sure?',
    text: "This book will be permanently deleted",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#bc0303',
    cancelButtonColor: '#FF6D1F',
    confirmButtonText: 'Delete'
  }).then((result) => {
    if (result.isConfirmed) {
      form.submit();
    }
  });
}
</script>

<%- include('partials/footer') %>

</body>
</html>
